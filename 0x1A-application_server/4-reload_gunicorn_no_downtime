#!/bin/bash

# Define the Gunicorn PID file location
GUNICORN_PID_FILE="/var/run/gunicorn.pid"

# Check if Gunicorn PID file exists
if [[ ! -f "$GUNICORN_PID_FILE" ]]; then
    echo "Error: Gunicorn PID file not found!"
    exit 1
fi

# Get the PID of the Gunicorn master process
GUNICORN_PID=$(cat "$GUNICORN_PID_FILE")

# Check if Gunicorn process is running
if ! kill -0 "$GUNICORN_PID" 2>/dev/null; then
    echo "Error: Gunicorn is not running!"
    exit 1
fi

# Reload Gunicorn gracefully using HUP signal
echo "Reloading Gunicorn gracefully..."
kill -HUP "$GUNICORN_PID"

# Verify if reload was successful
if [[ $? -eq 0 ]]; then
    echo "Gunicorn reloaded successfully."
else
    echo "Error: Failed to reload Gunicorn."
    exit 1
fi
